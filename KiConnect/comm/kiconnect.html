<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-Content-Type-Options" content="nosniff">
  <meta http-equiv="X-Frame-Options" content="DENY">
  <meta name="referrer" content="no-referrer">
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    script-src  'self' 'unsafe-inline' https://cdn.jsdelivr.net;
    style-src   'self' 'unsafe-inline';
    connect-src 'self' https://api.anthropic.com https://api.openai.com https://chat.kiconnect.nrw https://openrouter.ai https://api.mistral.ai https://generativelanguage.googleapis.com https://api.x.ai https://api.groq.com;
    img-src     'self' data: blob:;
    font-src    'self' https://cdn.jsdelivr.net;
    frame-src   'none';
    object-src  'none';
    base-uri    'self';
    form-action 'self';
    upgrade-insecure-requests;
  ">
  <title>AI Chat</title>

  <link rel="stylesheet" href="kiconnect.css">

  <!--
    MathJax config MUST be defined inline before MathJax loads â€“
    it cannot be moved to kiconnect.js without breaking async startup.
  -->
  <script>
    window.MathJax = {
      tex: {
        inlineMath:  [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$'], ['\\[', '\\]']],
        processEscapes: true,
      },
      options: { skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'] },
      startup: { typeset: false },
    };
  </script>

  <!-- Third-party libraries (CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" async></script>
  <script src="https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/build/pdf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.1.6/dist/purify.min.js"></script>

  <!-- PDF.js worker â€“ must follow the pdfjs-dist script -->
  <script>
    if (typeof pdfjsLib !== 'undefined') {
      pdfjsLib.GlobalWorkerOptions.workerSrc =
        'https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/build/pdf.worker.min.js';
      window._pdfjsLib = pdfjsLib;
    }
  </script>
</head>
<body>

<div class="overlay" id="overlay"></div>
<div class="toast"    id="toast"></div>
<div class="ctx-menu" id="ctxMenu" style="display:none"></div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     LOGIN SCREEN
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="loginScreen" style="display:none;position:fixed;inset:0;background:var(--bg);z-index:9999;align-items:center;justify-content:center;flex-direction:column;gap:16px;">
  <div style="text-align:center;margin-bottom:8px;">
    <div style="font-size:48px;margin-bottom:12px;">ğŸ¤–</div>
    <h1 style="font-size:26px;font-weight:800;color:var(--text);" data-i18n="login.title">KI Connect</h1>
    <p id="loginSubtitle" style="font-size:14px;color:var(--muted);margin-top:6px;" data-i18n="login.subtitle">Enter your password to continue</p>
  </div>
  <div style="width:340px;max-width:90vw;">

    <!-- Login mode -->
    <div id="loginModeFields">
      <input class="setting-input" type="password" id="loginInput"
        placeholder="Passwordâ€¦" data-i18n="login.placeholder" data-i18n-attr="placeholder"
        style="width:100%;font-size:16px;padding:12px 14px;margin-bottom:10px;">
      <div style="color:var(--red);font-size:13px;min-height:18px;margin-bottom:8px;font-family:'IBM Plex Mono',monospace;" id="loginError"></div>
      <button class="save-btn" style="width:100%;padding:12px;" id="loginBtn" data-i18n="login.btn">ğŸ”“ Login</button>
      <div style="text-align:center;margin-top:14px;">
        <button id="forgotPwdBtn" style="background:none;border:none;color:var(--muted);font-size:12px;cursor:pointer;font-family:'IBM Plex Mono',monospace;text-decoration:underline;" data-i18n="login.forgot">Forgot password?</button>
      </div>
    </div>

    <!-- Setup mode -->
    <div id="setupModeFields" style="display:none;">
      <p style="font-size:12px;color:var(--muted);line-height:1.6;margin-bottom:12px;font-family:'IBM Plex Mono',monospace;" data-i18n="login.setupHint">
        This password protects access to KI Connect and encrypts your API keys in the browser.
      </p>
      <input class="setting-input" type="password" id="setupPwdInput"
        placeholder="New password (min. 8 chars)â€¦" data-i18n="login.setupPlaceholder" data-i18n-attr="placeholder"
        style="width:100%;font-size:16px;padding:12px 14px;margin-bottom:8px;">
      <input class="setting-input" type="password" id="setupPwdConfirm"
        placeholder="Confirm passwordâ€¦" data-i18n="login.setupConfirmPlaceholder" data-i18n-attr="placeholder"
        style="width:100%;font-size:16px;padding:12px 14px;margin-bottom:10px;">
      <div style="height:4px;border-radius:2px;background:var(--border);margin-bottom:12px;overflow:hidden;">
        <div id="pwdStrengthBar" style="height:100%;width:0%;transition:width 0.3s,background 0.3s;border-radius:2px;"></div>
      </div>
      <div style="color:var(--red);font-size:13px;min-height:18px;margin-bottom:8px;font-family:'IBM Plex Mono',monospace;" id="setupError"></div>
      <button class="save-btn" style="width:100%;padding:12px;" id="setupBtn" data-i18n="login.setupBtn">ğŸ” Create password &amp; start</button>
    </div>

  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SETTINGS PANEL
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="panel" id="settingsPanel">
  <div class="panel-title">
    <span data-i18n="settings.title">Settings</span>
    <button class="close-btn" id="settingsPanelClose">âœ•</button>
  </div>

  <div class="section-header" data-i18n="settings.activeProvider">Provider (active)</div>
  <div class="info-box" id="activeProviderInfo" data-i18n="settings.noProvider">No provider selected.</div>
  <button class="ghost-btn" id="goProviderFromSettings" data-i18n="settings.manageProviders">ğŸ”Œ Manage providers â†’</button>
  <button class="ghost-btn" style="margin-top:4px;" id="goModelLimits" data-i18n="settings.modelLimits">ğŸ“Š Adjust model limits â†’</button>
  <div id="proxyHint" style="font-size:11px;color:var(--muted);margin-top:8px;font-family:'IBM Plex Mono',monospace;line-height:1.5;display:none;"
    data-i18n="cors.hint" data-i18n-html="true">
    âš ï¸ CORS issue? Start <strong style="color:var(--text)">proxy.py</strong> and open
    <a href="http://localhost:5000" target="_blank" style="color:var(--accent)">localhost:5000</a>
  </div>

  <hr class="divider">
  <div class="section-header" data-i18n="settings.model">Model</div>
  <div class="setting-group">
    <select class="setting-input" id="modelInput">
      <option value="" data-i18n="settings.noProviderOpt2">â€” Configure provider â€”</option>
    </select>
  </div>

  <div class="section-header" data-i18n="conv.params">Conversation parameters</div>
  <div class="setting-group">
    <div class="setting-label">
      <span data-i18n="settings.chatWidth">Chat width</span>
      <span class="range-val" id="chatWidthVal">880px</span>
    </div>
    <input class="setting-input" type="range" min="480" max="3000" step="40" value="880" id="chatWidthSlider">
  </div>
  <div class="setting-group">
    <div class="setting-label">
      <span data-i18n="settings.temperature">Temperature</span>
      <span class="range-val" id="tempVal">0.7</span>
    </div>
    <input class="setting-input" type="range" min="0" max="2" step="0.1" value="0.7" id="temperature">
  </div>
  <div class="setting-group">
    <div class="setting-label" data-i18n="settings.systemPrompt">System Prompt (default)</div>
    <textarea class="setting-input" id="systemPrompt" rows="4"
      placeholder="You are a helpful assistant..."
      data-i18n="settings.systemPlaceholder" data-i18n-attr="placeholder"></textarea>
  </div>
  <div style="font-size:11px;color:var(--muted);font-family:'IBM Plex Mono',monospace;margin-top:4px;" id="modelMaxInfo"></div>
  <p style="font-size:11px;color:var(--muted);margin-top:8px;line-height:1.5;" data-i18n="settings.maxTokensAuto">
    Max tokens are taken automatically from the model.
  </p>
  <button class="save-btn" id="saveSettingsBtn" data-i18n="settings.saveBtn">ğŸ’¾ Save &amp; load models</button>

  <hr class="divider">
  <div class="section-header" data-i18n="settings.security">ğŸ”’ Security</div>
  <p style="font-size:11px;color:var(--muted);line-height:1.5;margin-bottom:10px;" data-i18n="settings.secDesc">
    API keys are encrypted with AES-GCM-256 in the browser.
  </p>

  <div class="section-header" style="margin-top:0;" data-i18n="settings.changeLoginPwd">Change Login Password</div>
  <div class="setting-group">
    <div class="setting-label" data-i18n="settings.currentPwd">Current password</div>
    <input class="setting-input" type="password" id="currentPwdInput"
      placeholder="Current passwordâ€¦" data-i18n="settings.currentPwdPlaceholder" data-i18n-attr="placeholder">
  </div>
  <div class="setting-group">
    <div class="setting-label" data-i18n="settings.newPwd">New password</div>
    <input class="setting-input" type="password" id="newPwdInput"
      placeholder="New passwordâ€¦" data-i18n="settings.newPwdPlaceholder" data-i18n-attr="placeholder">
  </div>
  <div class="setting-group">
    <div class="setting-label" data-i18n="settings.confirmPwd">Confirm password</div>
    <input class="setting-input" type="password" id="confirmPwdInput"
      placeholder="Repeat passwordâ€¦" data-i18n="settings.confirmPwdPlaceholder" data-i18n-attr="placeholder">
  </div>
  <button class="ghost-btn" style="margin-top:4px;" id="changePwdBtn" data-i18n="settings.changePwdBtn">ğŸ”‘ Change password</button>

  <hr class="divider">
  <div class="section-header" data-i18n="settings.sessionDuration">Session duration</div>
  <div style="display:flex;gap:8px;align-items:center;margin-bottom:8px;">
    <div style="flex:1;">
      <div class="setting-label" data-i18n="settings.sessionHours">Hours</div>
      <input class="setting-input" type="number" id="sessionHoursInput" min="0" max="168" value="12" style="text-align:center;">
    </div>
    <div style="flex:1;">
      <div class="setting-label" data-i18n="settings.sessionMinutes">Minutes</div>
      <input class="setting-input" type="number" id="sessionMinutesInput" min="0" max="59" value="0" style="text-align:center;">
    </div>
  </div>
  <div style="display:flex;gap:6px;">
    <button class="ghost-btn" style="margin:0;flex:1;" id="applySessionBtn" data-i18n="settings.sessionApply">â± Apply</button>
    <button class="ghost-btn" style="margin:0;flex:1;" id="resetSessionBtn" data-i18n="settings.sessionReset">ğŸ”„ Reset now</button>
  </div>
  <div style="margin-top:8px;font-size:12px;font-family:'IBM Plex Mono',monospace;color:var(--muted);">
    <span data-i18n="settings.sessionTimeLeft">Time remaining</span>:
    <span id="sessionCountdown" style="color:var(--accent);">â€”</span>
  </div>

  <hr class="divider">
  <button class="ghost-btn" style="margin-top:0;margin-bottom:6px;" id="logoutBtn" data-i18n="settings.logout">ğŸ”“ Log out now</button>
  <button class="ghost-btn" style="border-color:var(--red);color:var(--red);" id="clearAllBtn" data-i18n="settings.clearAll">ğŸ—‘ Delete all data &amp; keys</button>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     PROVIDER PANEL
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="panel" id="providerPanel">
  <div class="panel-title">
    <span data-i18n="provider.title">Providers / Servers</span>
    <button class="close-btn" id="providerPanelClose">âœ•</button>
  </div>
  <p style="font-size:12px;color:var(--muted);margin-bottom:14px;line-height:1.5;"
    data-i18n="provider.desc" data-i18n-html="true">
    All configured providers are <strong style="color:var(--green)">active simultaneously</strong>.
  </p>
  <div class="provider-list" id="providerList"></div>
  <button class="ghost-btn" id="addProviderBtn" data-i18n="provider.addNew">ï¼‹ Add new provider</button>

  <div class="provider-editor" id="providerEditor" style="display:none">
    <div style="font-size:14px;font-weight:700;margin-bottom:12px;" id="providerEditorTitle" data-i18n="provider.edit">Edit provider</div>
    <div class="setting-label" data-i18n="provider.name">Name</div>
    <input class="setting-input" type="text" id="pvNameInput"
      placeholder="e.g. KI Connect NRW, OpenAI, Custom Server"
      data-i18n="provider.namePlaceholder" data-i18n-attr="placeholder">
    <div class="setting-label" style="margin-top:10px;" data-i18n="provider.type">Type</div>
    <div class="provider-type-row" id="providerTypeRow">
      <div class="type-chip selected" data-type="openai-compat">OpenAI-compatible</div>
      <div class="type-chip" data-type="anthropic">Anthropic</div>
      <div class="type-chip" data-type="openai-direct">OpenAI</div>
      <div class="type-chip" data-type="openrouter">OpenRouter</div>
      <div class="type-chip" data-type="mistral">Mistral</div>
      <div class="type-chip" data-type="gemini">Gemini</div>
      <div class="type-chip" data-type="xai">xAI Grok</div>
      <div class="type-chip" data-type="groq">Groq</div>
    </div>
    <div id="pvProviderHint" style="font-size:10px;color:var(--muted);margin-top:6px;font-family:'IBM Plex Mono',monospace;line-height:1.5;display:none;padding:6px 8px;background:rgba(61,126,255,0.05);border-radius:6px;border:1px solid rgba(61,126,255,0.15);"></div>
    <div id="pvServerUrlGroup" style="margin-top:10px;">
      <div class="setting-label" data-i18n="provider.serverUrl">Server URL</div>
      <input class="setting-input" type="url" id="pvServerUrl" placeholder="https://chat.kiconnect.nrw/api/v1">
      <div style="font-size:10px;color:var(--muted);margin-top:3px;font-family:'IBM Plex Mono',monospace;" data-i18n="provider.serverHint">Full base URL</div>
    </div>
    <div style="margin-top:10px;">
      <div class="setting-label" data-i18n="provider.apiKey">API Key</div>
      <input class="setting-input" type="password" id="pvApiKey" placeholder="sk-...">
    </div>
    <div style="display:flex;gap:8px;margin-top:14px;">
      <button class="save-btn" style="margin:0;flex:1;" id="saveProviderBtn" data-i18n="provider.save">ğŸ’¾ Save</button>
      <button class="edit-cancel-btn" id="cancelProviderBtn" data-i18n="provider.cancel">Cancel</button>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     PROFILE PANEL
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="panel" id="profilePanel">
  <div class="panel-title">
    <span data-i18n="profile.title">User Profiles</span>
    <button class="close-btn" id="profilePanelClose">âœ•</button>
  </div>
  <p style="font-size:12px;color:var(--muted);margin-bottom:14px;line-height:1.5;"
    data-i18n="profile.desc" data-i18n-html="true">
    Profiles define roles or personas.
  </p>
  <div class="profile-list" id="profileList"></div>
  <button class="ghost-btn" id="addProfileBtn" data-i18n="profile.addNew">ï¼‹ Create new profile</button>

  <div class="profile-editor" id="profileEditor" style="display:none">
    <div style="font-size:14px;font-weight:700;margin-bottom:12px;" id="profileEditorTitle" data-i18n="profile.new">New Profile</div>
    <div class="setting-label" data-i18n="profile.name">Name</div>
    <input class="setting-input" type="text" id="peNameInput"
      placeholder="e.g. Math Professor, Student"
      data-i18n="profile.namePlaceholder" data-i18n-attr="placeholder">
    <div class="setting-label" style="margin-top:10px;" data-i18n="profile.modelForProfile">Model for this profile</div>
    <select class="setting-input" id="peModelInput">
      <option value="" data-i18n="profile.globalModel">â€” Use global model â€”</option>
    </select>
    <div class="setting-label" style="margin-top:10px;" data-i18n="profile.systemPrompt">System Prompt</div>
    <textarea class="setting-input" id="peSysPrompt" rows="3"
      placeholder="Describe how the AI should respondâ€¦"
      data-i18n="profile.sysPHint" data-i18n-attr="placeholder"></textarea>
    <div class="setting-label" style="margin-top:10px;">
      <span data-i18n="profile.temperature">Temperature</span>
      <span class="range-val" id="peTempVal">0.7</span>
    </div>
    <input class="setting-input" type="range" min="0" max="2" step="0.1" value="0.7" id="peTemp">
    <div style="margin-top:10px;">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:6px;">
        <span class="setting-label" style="margin:0;" data-i18n="profile.maxOutput">Max output tokens</span>
        <span style="font-size:10px;color:var(--accent);font-family:'IBM Plex Mono',monospace;" id="peModelMaxLabel"></span>
      </div>
      <label style="display:flex;align-items:center;gap:8px;cursor:pointer;margin-bottom:8px;font-size:13px;color:var(--muted);">
        <input type="checkbox" id="peUseModelMax" checked style="accent-color:var(--accent);width:15px;height:15px;">
        <span data-i18n="profile.autoMax">Use model maximum automatically</span>
      </label>
      <div id="peMaxTokensGroup" style="display:none;">
        <div style="display:flex;align-items:center;gap:10px;">
          <input class="setting-input" type="range" id="peMaxTokensSlider" min="256" max="8096" step="256" value="4096"
            style="flex:1;padding:0;cursor:pointer;accent-color:var(--accent);">
          <span style="font-family:'IBM Plex Mono',monospace;font-size:13px;color:var(--accent);min-width:64px;text-align:right;" id="peMaxTokensNum">4,096</span>
        </div>
      </div>
    </div>
    <div class="setting-label" style="margin-top:10px;" data-i18n="profile.color">Color</div>
    <div class="color-row" id="colorRow"></div>
    <div style="display:flex;gap:8px;margin-top:14px;">
      <button class="save-btn" style="margin:0;flex:1;" id="saveProfileBtn" data-i18n="profile.save">ğŸ’¾ Save</button>
      <button class="edit-cancel-btn" id="cancelProfileBtn" data-i18n="profile.cancel">Cancel</button>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     MODEL LIMITS PANEL
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="panel" id="modelMaxPanel">
  <div class="panel-title">
    <span data-i18n="modellimits.title">Model Limits</span>
    <button class="close-btn" id="modelMaxPanelClose">âœ•</button>
  </div>
  <p style="font-size:12px;color:var(--muted);margin-bottom:14px;line-height:1.5;"
    data-i18n="modellimits.desc" data-i18n-html="true">
    Adjust maximum output length per model.
  </p>
  <div id="modelMaxList" style="display:flex;flex-direction:column;gap:6px;"></div>
  <button class="ghost-btn" style="margin-top:12px;" id="resetAllModelMaxBtn" data-i18n="modellimits.resetAll">â†º Reset all</button>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     HEADER
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<header>
  <div class="header-left">
    <button class="sidebar-toggle-btn" id="sidebarToggleBtn" title="Toggle sidebar">â˜°</button>
  </div>

  <!-- Custom model dropdown (replaces native select to avoid overflow clipping) -->
  <div class="cm-wrap" id="cmWrap">
    <div class="cm-trigger" id="cmTrigger" title="Select model">
      <span class="cm-label" id="cmLabel" data-i18n="js.selectModel">â€” Open settings â€”</span>
      <span class="cm-arrow">â–¼</span>
    </div>
    <div class="cm-panel" id="cmPanel">
      <div class="cm-search-wrap">
        <input class="cm-search" id="cmSearch" type="text" placeholder="Search modelâ€¦" autocomplete="off" spellcheck="false">
      </div>
      <div class="cm-list" id="cmList"></div>
    </div>
  </div>
  <!-- Hidden select used as data store / compatibility shim -->
  <select class="model-select" id="modelSelector">
    <option value="" data-i18n="js.selectModel">â€” Open settings â€”</option>
  </select>

  <!-- Thinking / Reasoning toggle -->
  <div class="thinking-group" id="thinkingGroup" style="display:none;">
    <div class="thinking-toggle" id="thinkingToggle" title="Enable Extended Thinking / Reasoning">
      <span class="brain-icon">ğŸ§ </span>
      <span id="thinkingToggleLabel" data-i18n="thinking.toggle">Think</span>
    </div>
    <div class="thinking-intensity" id="thinkingIntensity">
      <label id="thinkingIntensityLabel">Budget</label>
      <input type="range" id="thinkingIntensitySlider" min="1" max="3" step="1" value="2">
      <span class="intensity-val" id="thinkingIntensityVal">medium</span>
    </div>
  </div>

  <div class="header-right">
    <div class="profile-badge" id="profileBadge" title="User profiles">
      <div class="profile-dot" id="profileBadgeDot" style="background:var(--muted)"></div>
      <span id="profileBadgeName" data-i18n="header.noProfile">No Profile</span>
    </div>
    <div class="status-dot" id="statusDot"></div>
    <button class="settings-btn" id="openProviderHeaderBtn" title="Providers &amp; Servers">ğŸ”Œ</button>
    <button class="settings-btn" id="openSettingsBtn"       title="Settings">âš™</button>
    <div class="lang-switcher" id="langSwitcher">
      <button class="lang-btn" id="langToggleBtn" title="Language / Sprache">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/>
          <path d="M2 12h20M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>
        </svg>
        <span id="langBtnLabel">EN</span>
      </button>
      <div class="lang-dropdown" id="langDropdown"></div>
    </div>
  </div>
</header>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     MAIN LAYOUT
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="main">
  <!-- Sidebar -->
  <div class="sidebar" id="sidebar">
    <div class="sidebar-scroll" id="folderContainer"></div>
    <div class="sidebar-actions">
      <button class="sidebar-action-btn" id="newChatBtn"      data-i18n="sidebar.newChat">ï¼‹ Chat</button>
      <button class="sidebar-action-btn" id="newFolderBtn"    data-i18n="sidebar.newFolder">ğŸ“ Folder</button>
      <button class="sidebar-action-btn" id="copyFullChatBtn" title="Copy full chat" data-i18n="sidebar.copyChat">ğŸ“‹</button>
    </div>
    <div class="sidebar-resizer" id="sidebarResizer" title="Resize sidebar"></div>
  </div>

  <!-- Chat area -->
  <div class="chat-area" id="chatArea">
    <div class="drop-overlay" id="dropOverlay">
      <div class="drop-overlay-icon">ğŸ“‚</div>
      <div class="drop-overlay-text" data-i18n="input.dropText">Drop file here</div>
    </div>

    <div class="messages" id="messages">
      <div class="empty-state" id="emptyState">
        <div class="empty-icon">ğŸ¤–</div>
        <h2 data-i18n="empty.title">Ready to chat</h2>
        <p data-i18n="empty.desc">Configure a provider (ğŸ”Œ) and optionally choose a user profile.</p>
        <div class="suggestions" id="suggestionChips"></div>
      </div>
    </div>

    <div class="input-zone">
      <div class="attachment-row" id="attachmentRow"></div>
      <div class="input-box">
        <textarea id="messageInput" rows="1"
          placeholder="Send a messageâ€¦"
          data-i18n="input.placeholder" data-i18n-attr="placeholder"></textarea>
        <div class="input-actions">
          <button class="action-btn" id="attachFileBtn"  title="Attach file">ğŸ“</button>
          <button class="action-btn" id="attachImageBtn" title="Attach image">ğŸ–¼ï¸</button>
          <button class="action-btn" id="clearAttachBtn" title="Clear attachments">ğŸ—‘ï¸</button>
          <button class="send-btn" id="sendBtn">
            <svg id="sendIcon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
              <line x1="22" y1="2" x2="11" y2="13"/>
              <polygon points="22 2 15 22 11 13 2 9 22 2"/>
            </svg>
            <svg id="stopIcon" viewBox="0 0 24 24" fill="currentColor" style="display:none">
              <rect x="4" y="4" width="16" height="16" rx="2"/>
            </svg>
            <span id="sendBtnLabel" data-i18n="header.send">Send</span>
          </button>
        </div>
      </div>
      <div class="hint" id="inputHint" data-i18n="input.hint" data-i18n-html="true">
        <kbd>Enter</kbd> send Â· <kbd>Shift+Enter</kbd> line break
      </div>
    </div>
  </div>
</div>

<!-- Hidden file inputs -->
<input type="file" id="fileInput"
  accept="text/*,.txt,.md,.csv,.json,.xml,.yaml,.yml,.log,.py,.js,.ts,.html,.css,.sh,.bat,.ini,.cfg,.toml,.pdf,application/pdf"
  style="display:none">
<input type="file" id="imageInput" accept="image/*" style="display:none">

<!-- Application scripts (load order matters) -->
<script src="kiconnect-languages-i18n.js"></script>
<script src="kiconnect.js"></script>

</body>
</html>
